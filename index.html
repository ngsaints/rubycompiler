<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Ruby Compiler - Run Ruby Code Instantly</title>
    <meta name="description" content="Compile and run Ruby code instantly in your browser with our online Ruby compiler. Enjoy syntax highlighting and a user-friendly interface.">
    <meta name="keywords" content="Ruby, Ruby compiler, online Ruby compiler, run Ruby online, Ruby syntax highlighting">
    <meta name="author" content="Your Name">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <style>
        body {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.5s ease;
            /* font-family, background-color, color, margin, padding are handled by Bulma or not needed */
        }

        .container {
            /* background, box-shadow, padding, width, max-width, margin are handled by Bulma classes like 'section' or 'box' or are defaults */
            /* border-radius is handled by Bulma's elements (e.g. box has 6px) */
            text-align: center; /* Kept for centering content within the container */
            animation: fadeIn 1s ease; /* Kept for fade-in effect */
        }

        /* .container img styling removed as it's handled by <figure class="image..."> and spacing utilities like mb-4 */

        /* h1, h2 styling removed as they are handled by Bulma's .title and .subtitle classes */

        #editor {
            height: 200px; /* Kept: Specific height for the editor */
            border: 1px solid #ccc; /* Kept: Custom border for editor */
            border-radius: 4px; /* Changed: Aligned with Bulma's default (e.g., for input, textarea) */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1); /* Kept: Custom shadow for editor */
            transition: all 0.3s ease; /* Kept: Transition for editor focus */
            text-align: left; /* Ensure text inside editor is left-aligned */
        }

        #editor:focus {
            border-color: #2196F3; /* Kept: Custom focus border color */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2); /* Kept: Custom focus shadow */
            /* border-radius will be 4px from #editor style */
        }

        /* button, select, button:hover, button:active styling removed as Bulma classes handle these */

        pre#output {
            /* background-color, padding, border-radius, border are handled by the parent div.box */
            font-size: 1rem; /* Kept: Specific font size for output */
            white-space: pre-wrap; /* Kept: Important for formatting output */
            word-wrap: break-word; /* Kept: Important for formatting output */
            text-align: left; /* Ensure output text is left-aligned if parent .container has text-align:center */
            color: inherit; /* Ensure pre text color is consistent with Bulma's box content */
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdn.opalrb.com/opal/current/opal.min.js"></script>
    <script src="https://cdn.opalrb.com/opal/current/opal-parser.min.js"></script>
</head>
<body>
    <div class="container is-max-desktop section">
        <figure class="image is-128x128 is-inline-block mb-4">
            <img src="https://upload.wikimedia.org/wikipedia/commons/7/73/Ruby_logo.svg" alt="Ruby Logo" title="Ruby Programming Language Logo" style="width:100px;">
        </figure>
        <h1 class="title">Online Ruby Compiler with Opal</h1>
        <div id="editor" class="mb-4"># Write your Ruby code here...</div>

        <div class="field is-grouped is-grouped-multiline mb-4">
            <p class="control">
                <button id="run-code" class="button is-primary is-fullwidth">Compile and Execute</button>
            </p>
            <p class="control">
                <button id="save-code" class="button is-link is-fullwidth">Save Code</button>
            </p>
            <p class="control">
                <button id="load-code" class="button is-link is-light is-fullwidth">Load Code</button>
            </p>
            <p class="control">
                <button id="clear-output" class="button is-danger is-light is-fullwidth">Clear Output</button>
            </p>
            <p class="control">
                <button id="download-code" class="button is-info is-fullwidth">Download Code</button>
            </p>
            <p class="control">
                <input type="file" id="upload-file" accept=".rb" style="display: none;">
                <button id="upload-code-button" class="button is-info is-light is-fullwidth">Upload Code</button>
            </p>
        </div>

        <div class="field mb-4">
            <div class="control">
                <div class="select is-info is-fullwidth">
                    <select id="theme-selector">
                        <option value="ace/theme/textmate">Textmate</option>
                        <option value="ace/theme/monokai">Monokai</option>
                        <option value="ace/theme/github">GitHub</option>
                        <option value="ace/theme/twilight">Twilight</option>
                    </select>
                </div>
            </div>
        </div>

        <h2 class="subtitle">Output:</h2>
        <div class="box">
            <pre id="output"></pre>
        </div>
    </div>
    <script>
        // Initialize Ace Editor
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/textmate");
        editor.session.setMode("ace/mode/ruby");

        // Compile and execute Ruby code
        document.getElementById('run-code').addEventListener('click', function() {
            var rubyCode = editor.getValue();
            var outputElement = document.getElementById('output');
            outputElement.textContent = ""; // Clear previous output

            try {
                // Create a buffer to capture puts output
                var buffer = [];

                // Override puts method to capture output
                Opal.top.$puts = function(str) {
                    buffer.push(str);
                };

                // Compile and execute the Ruby code
                var jsCode = Opal.compile(rubyCode);
                new Function(jsCode)();

                // Display the captured output
                outputElement.textContent = buffer.join("\n");
            } catch (e) {
                outputElement.textContent = "Error: " + e.message;
            }
        });

        // Save code to LocalStorage
        document.getElementById('save-code').addEventListener('click', function() {
            var rubyCode = editor.getValue();
            localStorage.setItem('rubyCode', rubyCode);
            alert('Code saved successfully!');
        });

        // Load code from LocalStorage
        document.getElementById('load-code').addEventListener('click', function() {
            var rubyCode = localStorage.getItem('rubyCode');
            if (rubyCode) {
                editor.setValue(rubyCode, -1); // -1 to move cursor to the start
                alert('Code loaded successfully!');
            } else {
                alert('No code found in LocalStorage!');
            }
        });

        // Change editor theme
        document.getElementById('theme-selector').addEventListener('change', function() {
            var theme = this.value;
            editor.setTheme(theme);
        });

        // Clear output
        document.getElementById('clear-output').addEventListener('click', function() {
            document.getElementById('output').textContent = '';
        });

        // Download code
        document.getElementById('download-code').addEventListener('click', function() {
            var rubyCode = editor.getValue();
            var blob = new Blob([rubyCode], { type: 'text/ruby' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'code.rb';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // Upload code button triggers hidden file input
        document.getElementById('upload-code-button').addEventListener('click', function() {
            document.getElementById('upload-file').click();
        });

        // Handle file upload
        document.getElementById('upload-file').addEventListener('change', function(event) {
            var file = event.target.files[0];
            if (file) {
                if (file.name.endsWith('.rb')) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        editor.setValue(e.target.result, -1); // -1 to move cursor to the start
                        alert('File loaded successfully!');
                    };
                    reader.onerror = function(e) {
                        alert('Error reading file: ' + e.target.error.name);
                    };
                    reader.readAsText(file);
                } else {
                    alert('Please select a Ruby file (.rb)');
                }
            }
            // Reset the file input to allow uploading the same file again
            event.target.value = null;
        });
    </script>
</body>
</html>
